{% extends "domain/base.html" %}
{% load static %}


{%block content %}
    <style>
        .list-group > .list-group > .list-group-item {
            padding-left: 2.5rem;
        }

        .wider-container {
            width: 100%;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto;
        }

        @media (min-width: 576px) {
            .wider-container {
                max-width: 540px;
            }
        }

        @media (min-width: 768px) {
            .wider-container {
                max-width: 720px;
            }
        }

        @media (min-width: 992px) {
            .wider-container {
                max-width: 960px;
            }
        }

        @media (min-width: 1200px) {
            .wider-container {
                max-width: 1140px;
            }
        }

        @media (min-width: 1400px) {
            .wider-container {
                max-width: 1370px;
            }
        }

        @media (min-width: 1920px) {
            .wider-container {
                max-width: 1820px;
            }
        }

    </style>

  


    


  <style type="text/css">
    #mynetwork {
             position:relative;
      width: 1000px;
      height: 840px;
      border: 2px solid lightgray;
    }
    
        #mynetwork2 {
      width: q000px;
      height: 540px;
      border: 2px solid lightgray;
    }
        img{
        max-width: 100%;
        max-height: 100%;
        display: block; /* remove extra space below image */
    }
    .box{
        width: 1050px;        
        border: 5px solid black;
    }    
    
    .tab { margin-left: 90px; }
    .tab2 { margin-left: 60px; }
    .tab { margin-left: 50px; }
    
    
    .box.large{
        height: 300px;
    }
    .box.small{
        height: 100px;
    }
    
    
    
  </style>


<title>  DIGGER  Transcript {{ tran_name|safe }}  </title>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <div class="wider-container pt-5">
        <div class="row pt-5">
                          <!-- Vertical pill selection menu-->
                          <div class="col-lg-3">
                              {#                <h3 class="my-4">View selection</h3>#}
                              <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                  <a class="nav-link active" id="v-pills-home-tab" data-toggle="pill" href="#v-pills-overview"
                                     role="tab" aria-controls="v-pills-overview" aria-selected="true">Overview</a>
                                  <a class="nav-link" id="v-pills-protein-tab" data-toggle="pill" href="#v-pills-protein" role="tab"
                                     aria-controls="v-pills-protein" aria-selected="false">ProteinView</a>
                                  <a class="nav-link" id="v-pills-domain-tab" data-toggle="pill" href="#v-pills-domain" role="tab"
                                     aria-controls="v-pills-domain" aria-selected="false">DomainView</a>
                                  <a class="nav-link" id="v-pills-interaction-tab" data-toggle="pill" href="#v-pills-interaction"
                                     role="tab"
                                     aria-controls="v-pills-compare" aria-selected="false">InteractionView</a>
                                  <a class="nav-link" id="v-pills-compare-tab" data-toggle="pill" href="#v-pills-compare"
                                     role="tab"
                                     aria-controls="v-pills-interaction" aria-selected="false">Compare with other isoforms</a>
                              </div>
                          </div>
                          
                          
            <!-- /.col-lg-3 -->

            <!-- Tab / page content -->
            <div class="col-lg-9">
                <div class="tab-content" id="v-pills-tabContent">
                    <!-- Overview content -->
<div class="tab-pane fade show active" id="v-pills-overview" role="tabpanel" aria-labelledby="v-pills-overview-tab">
                                                   
                                                   
                                                   
                                               <h1 class="font-weight-light"> Protein Features </h1>
                                              <br>
                                              <h5 class="lead"><span
                                                      style="font-weight:bold"> Gene name </span>: {{ gene_description|safe }}
                                              </h5 class>
                                              
                                              
                                              <h5 class="lead"><span style="font-weight:bold">Transcript name</span>
                                                  : {{ tran_name|safe }}
                                              </h5 class>
                                              
                                              
                                              <h5 class="lead"><span style="font-weight:bold">NCBI gene ID </span>: <a
                                                      href="https://www.ncbi.nlm.nih.gov/gene/{{ entrezID|safe }}"
                                                      target="_blank">{{ entrezID|safe }} </a>
                                              </h5 class>
                                              
                                              
                                              <h5 class="lead"><span style="font-weight:bold">Ensembl</span> : <a
                                                      href="https://www.ensembl.org/id/{{ gID|safe }}"
                                                      target="_blank"> {{ gID|safe }} </a> ; <a
                                                      href="https://www.ensembl.org/id/{{ trID|safe }}"
                                                      target="_blank">{{ trID|safe }} </a>
                                              </h5 class>
                      
                      <center>
                                              <br> <br> <br>
                                              <p class="lead"><span style="font-weight:bold">Domain and exon architecture </span></p>
                      
                                              <div class="box.large">
                      
                                                  <img src="{% get_media_prefix %}images/{{ trID }}.png" >
                                              </div>
                      
                      
                                              <br>
                                              
                                              
                                              <h6>
                                                  <h5 class=="lead">  {{ text1|safe }} </h5 class>
                                                  {% autoescape off %}
                                                      {{ dt }}
                                                  {% endautoescape %}
                                              </h6>
                               
                               
                               
                               
                      </center>
                               
                               
                               
         
         
         
</div>

<!-- ProteinView content -->
<div class="tab-pane fade " id="v-pills-protein" role="tabpanel"  aria-labelledby="v-pills-protein-tab">
     

      <div id='overview'>
                                                <h1 class="font-weight-light"> ProteinView </h1>
                                                              
                                                            <h5 class="tab1">   ProteinView provides a general visualization of the protein and its domains interactions. Please select your view mode.</h5 class>
                                                 
                                                            
                                                            <h6 class="tab">   <span style="font-weight:bold">PPI View</span> : show only protein interactions. Nodes are proteins and the central node is the selected transcript.</h6 class>  
                                                            
                                                            <h6 class="tab">   <span style="font-weight:bold">PPI-DDI View</span> : proteins are shown together with their domains and domains-domains interactions. </h6 class>  
                                                             
                                                            <h6 class="tab1">  You can move the protein and domain nodes as you wish for a better view. Notice that the generated network in this view can be very big or difficult to visualize. In that case, DomainView or InteractionView can provide better visualization. </h6 class>
                                                            <br>
                                                
                                                  <h6 class=="tab" > 
                                                            <label>
                                                              <select id="nodeFilterSelect">
                                                                <option value="PPI"> PPI View</option>
                                                                <option value="PPI-DDI"> PPI-DDI View</option>
                                                              </select>
                                                            </label>
                                                </h6 class>  
                                                         
                                                    
                                                              </div>
                                                         <center>  

                                                        <div id="mynetwork"></div>
                                                       
                                                          <script type="text/javascript">

                                                                  var PR_LENGTH = 500,
                                                                  LENGTH_domain = 20,
                                                                  PR_DM= 400,
                                                                  LENGTH_SUB = 50,
                                                                  WIDTH_SCALE = 2,
                                                                  GREEN = "green",
                                                                  RED = "#C5000B",
                                                                  //ORANGE = "orange",
                                                                  YELLOW= "orange",
                                                                  WHITE = "EED5EB"
                                                                  //GRAY = '#666666',
                                                                  GRAY = "gray",
                                                                  BLACK = "#2B1B17";
                                                                  missing= '#C70039';
                                                               // create an array with nodes
                                                                var nodes = new vis.DataSet([
                                                
                                                                {% for node in pv_nodes %}
                                                                    {{ node|safe }}
                                                                {% endfor %}
                                                                
                                                
                                                
                                                    ]);
                                                              // create an array with edges
                                                              var edges = new vis.DataSet([
                                                              
                                                                {% for edge in pv_edges %}
                                                                    {{ edge|safe }}
                                                                {% endfor %}
                                                
                                                                ]);
                                                                
                                                                
                                                
                                                   
                                                                
                                                                
                                                           const nodeFilterSelector = document.getElementById("nodeFilterSelect");     
                                                           
                                                           
                                                            // create a network
                                                            var container = document.getElementById('mynetwork');
                                                            var data = {
                                                              nodes: nodes,
                                                              edges: edges
                                                            };
                                                             
                                                            
                                                            var options = {
 
             autoResize: true,
    width: '100%',
    height: '100%',
                                                               physics: {
                                                               enabled: true,
                                                                    barnesHut: { gravitationalConstant: -10000 },
                                                                    stabilization: { iterations: 2500 },
                                                                  },
                                                                           
                                                    
                                                    
                                                    
                                                                nodes: {
                                                                  scaling: {
                                                                    min: 16,
                                                                    max: 32
                                                                  }
                                                                },
                                                                edges: {
                                                                  color: WHITE,
                                                                  smooth: false,
                                                
                                                                },
                                                
                                                 
                                                                groups: {
                                                                  protein: {
                                                                    shape: "dot",
                                                                    color: GRAY, // orange
                                                                   font:
                                                                  {
                                                                  size: 18, // px
                                                                  }
                                                                  },
                                                                  
                                                                  
                                                                  domain: {
                                                                    shape: "triangle",
                                                                    color: "#2B7CE9" // blue
                                                                  },
                                                                  
                                                                  
                                                
                                                                  transcript: {
                                                                    shape: "square",
                                                                    color: "#109618" // green
                                                                  }
                                                                }
                                                              };
                                                                

                                                              
                                                
                                                        
                                                        
                                                        
                                                        
                                                        let nodeFilterValue = "";
                                                
                                                        
                                                        
                                                        
                                                        
                                                        const nodesFilter = node => {
                                                                if (nodeFilterValue === "") {
                                                                  return node.group === "protein"; 
                                                                }
                                                                switch (nodeFilterValue) {
                                                
                                                                  case "PPI-DDI":
                                                                    return  node.source === "DDI" ;
                                                                  
                                                                   case "PPI":
                                                                    return node.group === "protein";                
                                                                  
                                                                  default:
                                                                    return true;
                                                                }
                                                              };
                                                
                                                                 
                                                
                                                
                                                
                                                
                                                
                                                                const nodesView = new vis.DataView(nodes, { filter: nodesFilter });
                                                        
                                                                
                                                                nodeFilterSelector.addEventListener("change", e => {
                                                                  // set new value to filter variable
                                                                  nodeFilterValue = e.target.value;
                                                                  /*
                                                                        refresh DataView,
                                                                        so that its filter function is re-calculated with the new variable
                                                                      */
                                                                  nodesView.refresh();
                                                          


                                                                });
                                                                
                                                                
                                                                
                                                                



                                                   
                                                    function startNetwork(data) {
                                                
                                                var network=new vis.Network(container, data, options) ;
                                              
                                               }
               
                                                
                                                        startNetwork({ nodes: nodesView, edges: edges });
                                
                                                        network.ft();
                                                          </script>
                                                               <img src="{%static 'image/legend_1.svg'%}"alt="" >
                                                            </center>  
                                                              
                                                      
                                                 
                                                    
                                                      
                                                          <br />
                                                         {% if dis1 %}
                                                         <h6 class="tab1">  Dashe edges represent missing domains in the selected protein ({{ tran_name|safe }}) but present in other isoforms from other genes. These domains-domains interactions are lost. Which may also affect the interactions with their respective proteins. </h6 class>
                                                         {% endif %}
                                                
                                                
                                                
                                                
                                                
                                                
 </div>

                 
  
                    <!-- DomainView content -->
  <div class="tab-pane fade" id="v-pills-domain" role="tabpanel" aria-labelledby="v-pills-domain-tab">
                    
                    
                    
 <h2 class="font-weight-light"> DomainView </h2>
              
            <h5 class="tab1">  DomainView provides a more specific graphical visualization for each  domain.   The domain is shown only once, and all proteins containing the domain are linked to this domain node. Select your domain of interest from the following table. </h5 class>
 
     <center>
             <h4 class=="lead">  Domains of the isoform {{ tran_name|safe }}  </h4 class> 
       
       
         <h5 class >   
              {% autoescape off %}
                 {{ dt2 }}
                {% endautoescape %}
                  
        </h5 class>  
       </center> 
        
        {% if dis1 %}
   <br />
   <center>
   
    <h4 class=="lead">  Domains missing in the transcript but present in other isoforms.  </h4 class> 
    
     <h5 class >
          {% autoescape off %}
         {{ dt3 }}
        {% endautoescape %}
   
         </h5 class>     
             </center>     
         
                {% endif %}
  
                  
                  
                  <br /><br /><br /> 
       
   
   <h5 class=="lead">  Select your domain </h5 class> 
<label>

  <select id="nodeFilterSelect2">
  
  
                {% for s in switch1 %}
                    {{ s|safe }}
                {% endfor %}
                
                
  </select>
</label>
     


    <center>     
<div id="mynetwork2"></div>
          <script type="text/javascript">
                  var L1 = 300,
                  L2 = 30,
                  PR_DM= 400,
                  LENGTH_SUB = 50,
                  WIDTH_SCALE = 2,
                  GREEN = "green",
                  RED = "#C5000B",
                  //ORANGE = "orange",
                  YELLOW= "orange",
                  WHITE = "EED5EB"
                  //GRAY = '#666666',
                  GRAY = "gray",
                  BLACK = "#2B1B17";
          
               
               // create an array with nodes
                var nodes2 = new vis.DataSet([
                
                {% for node in Domainview_nodes %}
                    {{  node|safe }}
                {% endfor %}
                
    ]);
              // create an array with edges
              var edges2 = new vis.DataSet([

                {% for edge in Domainview_edges %}
                    {{ edge|safe }}
                {% endfor %}
                ]);
   
   
   
              const nodeFilterSelector2 = document.getElementById("nodeFilterSelect2");     

   
            // create a network
            var container2 = document.getElementById('mynetwork2');
            var data2 = {
              nodes2: nodes2,
              edges2: edges2
            };
            
            
            
            
            
  var options2 = {

    physics: {
                    barnesHut: { gravitationalConstant: -10000 },
                    stabilization: { iterations: 15 },
                  
                  },
    
    
    
                nodes: {
                  scaling: {
                    min: 16,
                    max: 32
                  }
                },
                edges: {
                  color: WHITE,
                  smooth: false,

                },

 
                groups: {
                  protein: {
                    shape: "dot",
                    color: GRAY, // orange
                   font:
                  {
                  size: 18, // px
                  }
                  },
                  
                  
                  Domain: {
                    shape: "triangle",
                    color: "#2B7CE9" // blue
                  },
                  
                  

                  MDomain: {
                    shape: "triangle",
                    color: "#109618" // green
                  }
                }
              };
                
                
                
                   
               
               
               
               
                
              function startNetwork(data2) {

                new vis.Network(container2, data2, options2);
              }
              

              let nodeFilterValue2 = "";

               
               
                  const nodesFilter2 = node => {
                    if (nodeFilterValue2 === "") {
                     return node.source ===  "{{ first_domain|safe}}";
                    }
                    switch (nodeFilterValue2) {
                        
                                {% for s in switch2 %}
                                    {{ s|safe }}
                                {% endfor %}   

                      default:
                        return true;
                    }
                  };
                                   






                const nodesView2 = new vis.DataView(nodes2, { filter: nodesFilter2 });
        
                
                nodeFilterSelector2.addEventListener("change", e => {
                  // set new value to filter variable
                  nodeFilterValue2 = e.target.value;
                  /*
                        refresh DataView,
                        so that its filter function is re-calculated with the new variable
                      */
                  nodesView2.refresh();
                });






        startNetwork({ nodes: nodesView2, edges: edges2 });     
       
       
       
            
          </script>
            </center>                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
</div>



                    <!-- InteractionView content -->
<div class="tab-pane fade" id="v-pills-interaction" role="tabpanel"
                         aria-labelledby="v-pills-interaction-tab">
                     
                
            <h2 class="font-weight-light" > InteractionView </h2>
            
            
            
            {% if dis2 %}
              
            <h5 class="tab1" style="text-align: left;">  InteractionView provides an  interactive visualization of the interaction for the selected isoform with every partner individually. The interactions in the table are confirmed by both Protein-Protein Interactions (PPI) and Domain-Domain Interactions (DDI) networks. You can select the protein partner to visualize it in a new tab. </h5 class>
            

 
<br />
          
       <center>
       <h4 class=="lead">  Protein partners of the isoform {{ tran_name|safe }}  </h4 class> 
       <h6 class >   
      {% autoescape off %}
         {{ dt4 }}
        {% endautoescape %}

               
                 
<br>
                <a href="{% get_media_prefix %}/table 2/{{trID|safe }}.csv" class="btn btn-secondary px-4 py-2 btn-sm">Download csv</a>
                
         </h6 class>  
          </center>     
         <br /><br />
                     <br />
           <h6 class="tab1" style="text-align: left;">  <span style="font-weight:bold">Retained DDIs</span> : For every partner, a list of  the retained DDI in this protein variant is shown. </h6 class>
           <h6 class="tab1" style="text-align: left;">  <span style="font-weight:bold">Lost DDIs</span>: The  interactions missing form the selected protein but present in other isoforms. You can check  other variants of this gene in the table below. </h6 class>
        
         {% else %}
                     <h5 class="tab1" style="text-align: left;">  The protein doesn't have any interaction confirmed by both PPI and DDI networks.</h5 class>

          {% endif %}
              
              
              
               <br /><br /><br />
              
              
                  </div>
            
                
                
                
                    <!-- Compare with other isoforms content -->
                    <div class="tab-pane fade" id="v-pills-compare" role="tabpanel"
                         aria-labelledby="v-pills-compare-tab">
                  
                  
                      {% if dis2 %} 
                        
            <h2 class="font-weight-light" > Compare with other isoforms </h2>
            
            
            
         
              
            <h5 class="tab1" style="text-align: left;">   </h5 class>
            

 

          
       <center>
       <h4 class=="lead">  List of isoforms  </h4 class> 
       <h6 class >   
      {% autoescape off %}
         {{ dt5 }}
        {% endautoescape %}

              
         </h6 class> 
                    </center>     
                  
          
                    {% endif %}
                      <div style="height: 150px"></div>
                    </div>
                  


  <div style="height: 150px"></div>
  <div style="height: 150px"></div>

                    </div>
            </div>
            <!-- /.col-lg-9 -->

     
      </div>   
</div>
{% endblock %}












































