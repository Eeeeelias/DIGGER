{% extends "domain/base.html" %}
{% load static %}

{%block content %}
  <style type="text/css">
    #mynetwork {
      width: 800px;
      height: 540px;
      border: 2px solid lightgray;
    }
        img{
        max-width: 100%;
        max-height: 100%;
        display: block; /* remove extra space below image */
    }
    .box{
        width: 1050px;        
        border: 5px solid black;
    }    
    
    .tab { margin-left: 90px; }
    .tab2 { margin-left: 60px; }
    .tab { margin-left: 50px; }
    
    
    .box.large{
        height: 300px;
    }
    .box.mid{
        height: 100px;
    }
    
  </style>

	<title>  DIGGER  Transcript {{ tran_name|safe }}  </title>

<div class="container">
  <div class="card border-0 shadow my-5">
    <div class="card-body p-3">
    
    <br><br>
      <h2 class="font-weight-light"> Protein Features </h2>
      <br>
      <h5 class="lead"> <span style="font-weight:bold"> Gene name </span>: {{ gene_description|safe }} </h5 class>  
      <h5 class="lead">  <span style="font-weight:bold">Transcript name</span> : {{ tran_name|safe }}  </h5 class>  
      <h5 class="lead">   <span style="font-weight:bold">NCBI gene ID </span>:   <a href="https://www.ncbi.nlm.nih.gov/gene/{{entrezID|safe }}"target="_blank">{{entrezID|safe }} </a>       </h5 class> 
      <h5 class="lead"> <span style="font-weight:bold">Ensembl</span> :  <a href="https://www.ensembl.org/id/{{gID|safe }}"target="_blank"> {{gID|safe }} </a>  ; <a href="https://www.ensembl.org/id/{{trID|safe }}"target="_blank">{{trID|safe }} </a> </h5 class> 
      
      
      <br> <br> <br>
      <center>
      <p class="lead"> <span style="font-weight:bold">Domain and exon architecture </span>  </p> 
      
      <div class="box.large">
      
      <img src="{% get_media_prefix %}images/{{trID}}.png" alt="My image">
      </div>
       
       
   <br>
  <h6 class >   
       
  <h5 class=="lead">  {{ text1|safe }} </h5 class> 
      {% autoescape off %}
         {{ dt }}
        {% endautoescape %}
 
       </center>     
         </h6 class>     
        
              

        
        
        
         <style type="text/css">
    #mynetwork {
      width: 1050px;
      height: 800px;
      border: 2px solid lightgray;
    }
  </style>



            <br /><br> <br> 
            <h2 class="font-weight-light"> ProteinView </h2>
              
            <h5 class="tab1">   ProteinView provides a general visualization of the protein and its domains interactions. Please select your view mode.</h5 class>
 
            <p class="tab">
            <h6 class="tab">   <span style="font-weight:bold">PPI View</span> : show only protein interactions. Nodes are proteins and the central node is the selected transcript.</h6 class>  
            <h6 class="tab">   <span style="font-weight:bold">PPI-DDI View</span> : proteins are shown together with their domains and domains-domains interactions. </h6 class>  
             
            <h6 class="tab1">  You can move the protein and domain nodes as you wish for a better view. Notice that the generated network in this view can be very big or difficult to visualize. In that case, DomainView or InteractionView can provide better visualization. </h6 class>
            <br>

  <h6 class=="tab" > 
            <label>
              <select id="nodeFilterSelect">
                <option value="PPI"> PPI View</option>
                <option value="PPI-DDI"> PPI-DDI View</option>
              </select>
            </label>
</h6 class>  
         
           <center>  
            
        <div id="mynetwork"></div>
          <script type="text/javascript">
          
        
          
                  var PR_LENGTH = 500,
                  LENGTH_domain = 20,
                  PR_DM= 400,
                  LENGTH_SUB = 50,
                  WIDTH_SCALE = 2,
                  GREEN = "green",
                  RED = "#C5000B",
                  //ORANGE = "orange",
                  YELLOW= "orange",
                  WHITE = "EED5EB"
                  //GRAY = '#666666',
                  GRAY = "gray",
                  BLACK = "#2B1B17";
                  missing= '#C70039';
               // create an array with nodes
                var nodes = new vis.DataSet([

                {% for node in pv_nodes %}
                    {{ node|safe }}
                {% endfor %}
                


    ]);
              // create an array with edges
              var edges = new vis.DataSet([
              
                {% for edge in pv_edges %}
                    {{ edge|safe }}
                {% endfor %}

                ]);
                
                

   
                
                
           const nodeFilterSelector = document.getElementById("nodeFilterSelect");     
           
           
            // create a network
            var container = document.getElementById('mynetwork');
            var data = {
              nodes: nodes,
              edges: edges
            };
            
            
            var options = {

               physics: {
                    barnesHut: { gravitationalConstant: -10000 },
                    stabilization: { iterations: 2500 },
                      avoidOverlap: 0.7
                  },
                           
    
    
    
                nodes: {
                  scaling: {
                    min: 16,
                    max: 32
                  }
                },
                edges: {
                  color: WHITE,
                  smooth: false,

                },

 
                groups: {
                  protein: {
                    shape: "dot",
                    color: GRAY, // orange
                   font:
                  {
                  size: 18, // px
                  }
                  },
                  
                  
                  domain: {
                    shape: "triangle",
                    color: "#2B7CE9" // blue
                  },
                  
                  

                  transcript: {
                    shape: "square",
                    color: "#109618" // green
                  }
                }
              };
                
              function startNetwork(data) {

                new vis.Network(container, data, options);
              }
              

        
        
        
        
        let nodeFilterValue = "";

        
        
        
        
        const nodesFilter = node => {
                if (nodeFilterValue === "") {
                  return node.group === "protein"; 
                }
                switch (nodeFilterValue) {

                  case "PPI-DDI":
                    return  node.source === "DDI" ;
                  
                   case "PPI":
                    return node.group === "protein";                
                  
                  default:
                    return true;
                }
              };

                 





                const nodesView = new vis.DataView(nodes, { filter: nodesFilter });
        
                
                nodeFilterSelector.addEventListener("change", e => {
                  // set new value to filter variable
                  nodeFilterValue = e.target.value;
                  /*
                        refresh DataView,
                        so that its filter function is re-calculated with the new variable
                      */
                  nodesView.refresh();
                });






        startNetwork({ nodes: nodesView, edges: edges });

          </script>
               <img src="{%static 'image/legend_1.svg'%}"alt=""  />
            </center>  
              
      
 
    
      
          <br />
         {% if dis1 %}
         <h6 class="tab1">  Dashe edges represent missing domains in the selected protein ({{ tran_name|safe }}) but present in other isoforms from other genes. These domains-domains interactions are lost. Which may also affect the interactions with their respective proteins. </h6 class>
         {% endif %}
         
        
         <br /><br />
            <h2 class="font-weight-light"> DomainView </h2>
              
            <h5 class="tab1">  DomainView provides a more specific graphical visualization for each  domain.   The domain is shown only once, and all proteins containing the domain are linked to this domain node. Select your domain of interest from the following table. </h5 class>
 
         <center>
             <h4 class=="lead">  Domains of the isoform {{ tran_name|safe }}  </h4 class> 
         <h5 class >   
       
   
      {% autoescape off %}
         {{ dt2 }}
        {% endautoescape %}
          
        </h5 class>  
        </center> 
        
        {% if dis1 %}
   <br />
   <center>
   
    <h4 class=="lead">  Domains missing in the transcript but present in other isoforms.  </h4 class> 
    
     <h5 class >
          {% autoescape off %}
         {{ dt3 }}
        {% endautoescape %}
   
         </h5 class>     
             </center>     
         
                {% endif %}
  
                  
                  
                  
                  
         <br /><br /><br /><br />
         
            <h2 class="font-weight-light" > InteractionView </h2>
            
            
            
            {% if dis2 %}
              
            <h5 class="tab1" style="text-align: left;">  InteractionView provides an  interactive visualization of the interaction for the selected isoform with every partner individually. The interactions in the table are confirmed by both Protein-Protein Interactions (PPI) and Domain-Domain Interactions (DDI) networks. You can select the protein partner to visualize it in a new tab. </h5 class>
            

 
<br />
          
       <center>
       <h4 class=="lead">  Protein partners of the isoform {{ tran_name|safe }}  </h4 class> 
       <h6 class >   
      {% autoescape off %}
         {{ dt4 }}
        {% endautoescape %}

               
                 
<br>
                <a href="{% get_media_prefix %}/table 2/{{trID|safe }}.csv" class="btn btn-secondary px-4 py-2 btn-sm">Download csv</a>
                 </center>     
         </h6 class>  
         <br /><br />
                     <br />
           <h6 class="tab1" style="text-align: left;">  <span style="font-weight:bold">Retained DDIs</span> : For every partner, a list of  the retained DDI in this protein variant is shown. </h6 class>
           <h6 class="tab1" style="text-align: left;">  <span style="font-weight:bold">Lost DDIs</span>: The  interactions missing form the selected protein but present in other isoforms. You can check  other variants of this gene in the table below. </h6 class>
        
         {% else %}
                     <h5 class="tab1" style="text-align: left;">  The protein doesn't have any interaction confirmed by both PPI and DDI networks.</h5 class>

          {% endif %}
              
              
              
               <br /><br /><br />
              
              
              
                {% if dis2 %} 
              
              
            <h2 class="font-weight-light" > Compare with other isoforms </h2>
            
            
            
         
              
            <h5 class="tab1" style="text-align: left;">   </h5 class>
            

 

          
       <center>
       <h4 class=="lead">  List of isoforms  </h4 class> 
       <h6 class >   
      {% autoescape off %}
         {{ dt5 }}
        {% endautoescape %}

                </center>     
         </h6 class>  
         
       

          {% endif %}
              

{% endblock content %}
